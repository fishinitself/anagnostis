<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Αναγνώστης</title>
</head>
<body>
<h1>Αναγνώστης</h1>
<textarea id="text-input" rows="10" cols="100" placeholder="Enter text here...">
  Η Αφροδίτη κατά την αρχαία ελληνική μυθολογία και θρησκεία είναι η θεά του έρωτα, της ομορφιάς,
  της σεξουαλικότητας, της ηδονής, των απολαύσεων και της τεκνοποίησης.
  Η αντίστοιχη θεότητα των Αρχαίων Ρωμαίων ήταν η Βένους (λατινικά: Venus),
  ενώ παρουσιάζει και πολλά κοινά στοιχεία με την αιγυπτιακή θεά Άθωρ.
  Σε αυτήν οφείλει το όνομά του ο πλανήτης Αφροδίτη.
</textarea>
<br>
<label for="rate">Rate (0.1 to 10):</label>
<input type="number" id="rate" min="0.1" max="10" step="0.1" value="0.5" onchange="set()">
<br>
<label for="pitch">Pitch (0 to 2):</label>
<input type="number" id="pitch" min="0" max="2" step="0.1" value="0.8" onchange="set()">
<br>
<label for="volume">Volume (0 to 1):</label>
<input type="number" id="volume" min="0" max="1" step="0.1" value="1" onchange="set()">
<br>

<!-- Buttons to control speech -->
<button onclick="pauseSpeech()">Start/Stop</button>
<button onclick="resetSpeech()">Reset</button>

<script>
    let speech
    let stopNextWord = false

    function set() {

        const voices = window.speechSynthesis.getVoices()
        voices.forEach(voice => {
            console.log(voice.name, voice.lang)
        })

        speech = new SpeechSynthesisUtterance(document.getElementById("text-input").value);
        speech.rate = document.getElementById("rate").value;
        speech.pitch = document.getElementById("pitch").value;
        speech.volume = document.getElementById("volume").value;
        speech.lang = "el-GR";

        speech.onboundary = function (event) {
            if (event.name === "word") {
                highlightWord(event.charIndex, event.charLength);
                if (stopNextWord) {
                    pauseSpeech();
                    stopNextWord = false;
                    return
                }
                if (checkFirstNonSpaceChar(speech.text.substring(event.charIndex + event.charLength))) {
                    stopNextWord = true;
                }
            }
        }
    }

    function checkFirstNonSpaceChar(str) {
        for (let i = 0; i < str.length; i++) {
            if (str[i] !== ' ') {
                if (str[i] === '\n' || str[i] === '.' || str[i] === ';' || str[i] === '!') {
                    return true;
                } else {
                    return false;
                }
            }
        }
        return false;
    }


    function highlightWord(startIndex, length) {
        const text = document.getElementById("text-input")
        text.focus()
        if (startIndex) {
            text.setSelectionRange(startIndex, startIndex + length)
        }
    }

    function pauseSpeech() {
        let speechS = window.speechSynthesis
        if (speechS.speaking) {
            if (!speechS.paused) {
                speechS.pause()
            } else {
                speechS.resume()
            }
        } else  {
            set()
            speechS.cancel()
            speechS.speak(speech)
        }
        document.getElementById("text-input").focus()
    }

    function resetSpeech() {
        window.speechSynthesis.cancel()
        document.getElementById("text-input").focus()
    }

</script>
</body>
</html>
